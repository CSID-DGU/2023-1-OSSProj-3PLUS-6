{"ast":null,"code":"import _defineProperty from\"C:/Users/yoons/Desktop/OSSPj/2023-1-OSSProj-3PLUS-6/Project/react-web/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _regeneratorRuntime from\"C:/Users/yoons/Desktop/OSSPj/2023-1-OSSProj-3PLUS-6/Project/react-web/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"C:/Users/yoons/Desktop/OSSPj/2023-1-OSSProj-3PLUS-6/Project/react-web/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"C:/Users/yoons/Desktop/OSSPj/2023-1-OSSProj-3PLUS-6/Project/react-web/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/yoons/Desktop/OSSPj/2023-1-OSSProj-3PLUS-6/Project/react-web/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState}from\"react\";import{useDrop}from\"react-dnd\";import{Table}from\"antd\";import StyledModal from\"../components/common/Modal\";import axios from\"axios\";import{useCookies}from\"react-cookie\";import styles from\"../css/Application.module.css\";import classNames from\"classnames\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var DroppableTable=function DroppableTable(_ref){var dataSource=_ref.dataSource,columns=_ref.columns,setAddedData=_ref.setAddedData,onRowClick=_ref.onRowClick,refreshSelectedCourses=_ref.refreshSelectedCourses,setCount=_ref.setCount,selectedRow=_ref.selectedRow,setSelectedRow=_ref.setSelectedRow;var _useCookies=useCookies([\"x_auth\"]),_useCookies2=_slicedToArray(_useCookies,1),cookies=_useCookies2[0];var token=cookies.x_auth;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isModalVisible=_useState2[0],setIsModalVisible=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isOverCountModalVisible=_useState4[0],setIsOverCountModalVisible=_useState4[1];// 초과 학점 모달 visible 상태\nvar _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isCheckModalVisible=_useState6[0],setIsCheckModalVisible=_useState6[1];var _useDrop=useDrop(function(){return{accept:\"COURSE\",drop:function(){var _drop=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(item,monitor){var data,res;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:data={userToken:token,lectureId:item.course._id};_context.prev=1;_context.next=4;return axios.post(\"/application/add\",data);case 4:res=_context.sent;if(res.status===200){setIsCheckModalVisible(true);refreshSelectedCourses();setCount(res.data.count);setAddedData(function(prevData){return[].concat(_toConsumableArray(prevData),[item.course]);});}_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);if(_context.t0.response.status===401){setIsModalVisible(true);}if(_context.t0.response.status===402){//초과학점 경고 모달\nsetIsOverCountModalVisible(true);setCount(_context.t0.response.data.count);}case 12:case\"end\":return _context.stop();}},_callee,null,[[1,8]]);}));function drop(_x,_x2){return _drop.apply(this,arguments);}return drop;}()};}),_useDrop2=_slicedToArray(_useDrop,2),dropRef=_useDrop2[1];var handleOk=function handleOk(){setIsModalVisible(false);setSelectedRow({tableId:null,rowId:null});};var handleCancel=function handleCancel(){setIsModalVisible(false);setSelectedRow({tableId:null,rowId:null});};var handleCancelcheck=function handleCancelcheck(){setIsCheckModalVisible(false);setSelectedRow({tableId:null,rowId:null});};var handleOkcheck=function handleOkcheck(){setIsCheckModalVisible(false);setSelectedRow({tableId:null,rowId:null});};var handleOverCountModalOk=function handleOverCountModalOk(){setIsOverCountModalVisible(false);setSelectedRow({tableId:null,rowId:null});};var handleOverCountModalCancel=function handleOverCountModalCancel(){setIsOverCountModalVisible(false);setSelectedRow({tableId:null,rowId:null});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Table,{ref:dropRef,dataSource:dataSource,columns:columns,onRow:function onRow(record){return{onClick:function onClick(){return onRowClick(record);},className:classNames(_defineProperty({},styles.selectedRow,record&&record._id&&selectedRow.tableId===\"table2\"?record._id===selectedRow.rowId:false))};}}),/*#__PURE__*/_jsx(StyledModal,{title:\"\\uACBD\\uACE0\",isOpen:isModalVisible,onCancel:handleCancel,handleOk:handleOk,message:\"\\uC774\\uBBF8 \\uC218\\uAC15 \\uC2E0\\uCCAD\\uB41C \\uAC15\\uC758\\uC785\\uB2C8\\uB2E4\"}),/*#__PURE__*/_jsx(StyledModal,{title:\"\\uD655\\uC778\",isOpen:isCheckModalVisible,onCancel:handleCancelcheck,handleOk:handleOkcheck,message:\"수강신청이 완료되었습니다\"// message={`${dataSource.name} ${dataSource.count} 수강신청이 완료되었습니다`}\n}),/*#__PURE__*/_jsx(StyledModal,{isOpen:isOverCountModalVisible,handleClose:handleOverCountModalCancel,message:\"\\uC218\\uAC15\\uC2E0\\uCCAD \\uAC00\\uB2A5\\uD55C \\uD559\\uC810\\uC744 \\uCD08\\uACFC\\uD558\\uC600\\uC2B5\\uB2C8\\uB2E4.\",handleOk:handleOverCountModalOk})]});};export default DroppableTable;","map":{"version":3,"names":["React","useState","useDrop","Table","StyledModal","axios","useCookies","styles","classNames","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","DroppableTable","_ref","dataSource","columns","setAddedData","onRowClick","refreshSelectedCourses","setCount","selectedRow","setSelectedRow","_useCookies","_useCookies2","_slicedToArray","cookies","token","x_auth","_useState","_useState2","isModalVisible","setIsModalVisible","_useState3","_useState4","isOverCountModalVisible","setIsOverCountModalVisible","_useState5","_useState6","isCheckModalVisible","setIsCheckModalVisible","_useDrop","accept","drop","_drop","_asyncToGenerator","_regeneratorRuntime","mark","_callee","item","monitor","data","res","wrap","_callee$","_context","prev","next","userToken","lectureId","course","_id","post","sent","status","count","prevData","concat","_toConsumableArray","t0","response","stop","_x","_x2","apply","arguments","_useDrop2","dropRef","handleOk","tableId","rowId","handleCancel","handleCancelcheck","handleOkcheck","handleOverCountModalOk","handleOverCountModalCancel","children","ref","onRow","record","onClick","className","_defineProperty","title","isOpen","onCancel","message","handleClose"],"sources":["C:/Users/yoons/Desktop/OSSPj/2023-1-OSSProj-3PLUS-6/Project/react-web/src/components/DroppableTable.js"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport { useDrop } from \"react-dnd\";\r\nimport { Table } from \"antd\";\r\nimport StyledModal from \"../components/common/Modal\";\r\nimport axios from \"axios\";\r\nimport { useCookies } from \"react-cookie\";\r\nimport styles from \"../css/Application.module.css\";\r\nimport classNames from \"classnames\";\r\n\r\nconst DroppableTable = ({\r\n  dataSource,\r\n  columns,\r\n  setAddedData,\r\n  onRowClick,\r\n  refreshSelectedCourses,\r\n  setCount,\r\n  selectedRow,\r\n  setSelectedRow,\r\n}) => {\r\n  const [cookies] = useCookies([\"x_auth\"]);\r\n  const token = cookies.x_auth;\r\n\r\n  const [isModalVisible, setIsModalVisible] = useState(false);\r\n  const [isOverCountModalVisible, setIsOverCountModalVisible] = useState(false); // 초과 학점 모달 visible 상태\r\n  const [isCheckModalVisible, setIsCheckModalVisible] = useState(false);\r\n\r\n  const [, dropRef] = useDrop(() => ({\r\n    accept: \"COURSE\",\r\n    drop: async (item, monitor) => {\r\n      const data = {\r\n        userToken: token,\r\n        lectureId: item.course._id,\r\n      };\r\n\r\n      try {\r\n        const res = await axios.post(\"/application/add\", data);\r\n\r\n        if (res.status === 200) {\r\n          setIsCheckModalVisible(true);\r\n          refreshSelectedCourses();\r\n          setCount(res.data.count);\r\n          setAddedData((prevData) => [...prevData, item.course]);\r\n        }\r\n      } catch (err) {\r\n        if (err.response.status === 401) {\r\n          setIsModalVisible(true);\r\n        }\r\n        if (err.response.status === 402) {\r\n          //초과학점 경고 모달\r\n          setIsOverCountModalVisible(true);\r\n          setCount(err.response.data.count);\r\n        }\r\n      }\r\n    },\r\n  }));\r\n\r\n  const handleOk = () => {\r\n    setIsModalVisible(false);\r\n    setSelectedRow({\r\n      tableId: null,\r\n      rowId: null,\r\n    });\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    setIsModalVisible(false);\r\n    setSelectedRow({\r\n      tableId: null,\r\n      rowId: null,\r\n    });\r\n  };\r\n\r\n  const handleCancelcheck = () => {\r\n    setIsCheckModalVisible(false);\r\n    setSelectedRow({\r\n      tableId: null,\r\n      rowId: null,\r\n    });\r\n  };\r\n\r\n  const handleOkcheck = () => {\r\n    setIsCheckModalVisible(false);\r\n    setSelectedRow({\r\n      tableId: null,\r\n      rowId: null,\r\n    });\r\n  };\r\n\r\n  const handleOverCountModalOk = () => {\r\n    setIsOverCountModalVisible(false);\r\n    setSelectedRow({\r\n      tableId: null,\r\n      rowId: null,\r\n    });\r\n  };\r\n\r\n  const handleOverCountModalCancel = () => {\r\n    setIsOverCountModalVisible(false);\r\n    setSelectedRow({\r\n      tableId: null,\r\n      rowId: null,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Table\r\n        ref={dropRef}\r\n        dataSource={dataSource}\r\n        columns={columns}\r\n        onRow={(record) => ({\r\n          onClick: () => onRowClick(record),\r\n          className: classNames({\r\n            [styles.selectedRow]:\r\n              record && record._id && selectedRow.tableId === \"table2\"\r\n                ? record._id === selectedRow.rowId\r\n                : false,\r\n          }),\r\n        })}\r\n      />\r\n      <StyledModal\r\n        title=\"경고\"\r\n        isOpen={isModalVisible}\r\n        onCancel={handleCancel}\r\n        handleOk={handleOk}\r\n        message=\"이미 수강 신청된 강의입니다\"\r\n      />\r\n      <StyledModal\r\n        title=\"확인\"\r\n        isOpen={isCheckModalVisible}\r\n        onCancel={handleCancelcheck}\r\n        handleOk={handleOkcheck}\r\n        message={\"수강신청이 완료되었습니다\"}\r\n        // message={`${dataSource.name} ${dataSource.count} 수강신청이 완료되었습니다`}\r\n      />\r\n      <StyledModal\r\n        isOpen={isOverCountModalVisible}\r\n        handleClose={handleOverCountModalCancel}\r\n        message=\"수강신청 가능한 학점을 초과하였습니다.\"\r\n        handleOk={handleOverCountModalOk}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default DroppableTable;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}